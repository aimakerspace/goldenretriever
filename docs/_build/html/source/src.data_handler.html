

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data Handlers &mdash; Golden-Retriever 0.3 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GoldenRetriever’s API Functions" href="api.html" />
    <link rel="prev" title="Finetuning GoldenRetriever" href="src.finetune.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Golden-Retriever
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Reference:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="src.models_subpackages.html">GoldenRetriever’s Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="src.finetune.html">Finetuning GoldenRetriever</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Handlers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-src.elasticsearch.create_doc_index">Elasticsearch Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-src.data_handler.kb_handler">Knowledge Base Handler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">GoldenRetriever’s API Functions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Golden-Retriever</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Data Handlers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/source/src.data_handler.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-handlers">
<h1>Data Handlers<a class="headerlink" href="#data-handlers" title="Permalink to this headline">¶</a></h1>
<p>GoldenRetriever’s knowledge bases can be preprocessed, parsed and uploaded into elasticsearch with the following subpackages.</p>
<div class="section" id="module-src.elasticsearch.create_doc_index">
<span id="elasticsearch-interface"></span><h2>Elasticsearch Interface<a class="headerlink" href="#module-src.elasticsearch.create_doc_index" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="src.elasticsearch.create_doc_index.upload_docs">
<code class="sig-prename descclassname">src.elasticsearch.create_doc_index.</code><code class="sig-name descname">upload_docs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">qa_pairs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.elasticsearch.create_doc_index.upload_docs" title="Permalink to this definition">¶</a></dt>
<dd><p>adds document with qa pair to elastic index
assumes that index fields correspond to template in create_doc_index.py</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>full_text</strong> – full text of document containing answer</p></li>
<li><p><strong>qa_pairs</strong> – list of dictionaries with key:value=’ans_id’:integer, ‘ans_str’:str, ‘query_str’=str, ‘query_id’=integer</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>document and qa_pair indexed to Elastic</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-src.data_handler.kb_handler">
<span id="knowledge-base-handler"></span><h2>Knowledge Base Handler<a class="headerlink" href="#module-src.data_handler.kb_handler" title="Permalink to this headline">¶</a></h2>
<p>kb_handler converts knowledge bases in various data types (txt, csv, sql) into a kb object.
This kb object may then be further used for finetuning and eval</p>
<dl class="py function">
<dt id="src.data_handler.kb_handler.generate_mappings">
<code class="sig-prename descclassname">src.data_handler.kb_handler.</code><code class="sig-name descname">generate_mappings</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">responses</span></em>, <em class="sig-param"><span class="n">queries</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.data_handler.kb_handler.generate_mappings" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a list of list mappings between responses and queries
The length of responses and queries must be the same.
To note, the argument takes Responses then Queries 
but the returned mappings list Queries then Responses 
for convenient use in downstream scripts</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>responses</strong> (<em>pd.Series</em>) – contains query strings, may be non unique</p></li>
<li><p><strong>queries</strong> (<em>pd.Series</em>) – contains query strings, may be non unique</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>mappings that is a list of list of ints containing mappings between queries responses</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="src.data_handler.kb_handler.kb">
<em class="property">class </em><code class="sig-prename descclassname">src.data_handler.kb_handler.</code><code class="sig-name descname">kb</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">responses</span></em>, <em class="sig-param"><span class="n">queries</span></em>, <em class="sig-param"><span class="n">mapping</span></em>, <em class="sig-param"><span class="n">vectorised_responses</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.data_handler.kb_handler.kb" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt id="src.data_handler.kb_handler.kb.create_df">
<code class="sig-name descname">create_df</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#src.data_handler.kb_handler.kb.create_df" title="Permalink to this definition">¶</a></dt>
<dd><p>Create pandas DataFrame in a similar format to dataloader.py
which may be used for finetuning and evaluation.</p>
<p>Importantly, if there is many-to-many matches between Queries and Responses
the returned dataframe will have duplicates</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>pd.DataFrame that contains the columns query_string, processed_string, kb_name</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="src.data_handler.kb_handler.kb.json">
<code class="sig-name descname">json</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hashkey</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.data_handler.kb_handler.kb.json" title="Permalink to this definition">¶</a></dt>
<dd><p>Create json dict to use with flask endpoint</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="src.data_handler.kb_handler.kb_handler">
<em class="property">class </em><code class="sig-prename descclassname">src.data_handler.kb_handler.</code><code class="sig-name descname">kb_handler</code><a class="headerlink" href="#src.data_handler.kb_handler.kb_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>kb_handler loads knowledge bases from text files</p>
<dl class="py method">
<dt id="src.data_handler.kb_handler.kb_handler.load_es_kb">
<code class="sig-name descname">load_es_kb</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">kb_names</span><span class="o">=</span><span class="default_value">[]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.data_handler.kb_handler.kb_handler.load_es_kb" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the knowledge bases from elasticsearch</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>kb_names</strong> (<em>list</em>) – to list specific kb_names to parse
else if empty, parse all of them</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of kb class objects</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="src.data_handler.kb_handler.kb_handler.load_sql_kb">
<code class="sig-name descname">load_sql_kb</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cnxn_str</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">cnxn_path</span><span class="o">=</span><span class="default_value">'../db_cnxn_str.txt'</span></em>, <em class="sig-param"><span class="n">kb_names</span><span class="o">=</span><span class="default_value">[]</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.data_handler.kb_handler.kb_handler.load_sql_kb" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the knowledge bases from SQL.</p>
<p>GoldenRetriever keeps the responses text in the 
text and vectorized_knowledge attributes 
as dictionaries indexed by their respective kb names</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cnxn_path</strong> (<em>str</em>) – string directory of the connection string 
that needs to be fed into pyodbc</p></li>
<li><p><strong>kb_names</strong> (<em>list</em>) – to list specific kb_names to parse
else if empty, parse all of them</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of kb class objects</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="src.data_handler.kb_handler.kb_handler.parse_csv">
<code class="sig-name descname">parse_csv</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="n">answer_col</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">query_col</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">context_col</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">kb_name</span><span class="o">=</span><span class="default_value">''</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.data_handler.kb_handler.kb_handler.parse_csv" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse CSV file into kb format
As pandas leverages csv.sniff to parse the csv, this function leverages pandas.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kb_name</strong> (<em>str</em>) – name of output kb object</p></li>
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – contains the queries, responses and context strings</p></li>
<li><p><strong>answer_col</strong> (<em>str</em>) – column name string that points to responses</p></li>
<li><p><strong>query_col</strong> (<em>str</em>) – column name string that points to queries</p></li>
<li><p><strong>context_col</strong> (<em>str</em>) – column name string that points to context strings</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>kb class object</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="src.data_handler.kb_handler.kb_handler.parse_df">
<code class="sig-name descname">parse_df</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">kb_name</span></em>, <em class="sig-param"><span class="n">df</span></em>, <em class="sig-param"><span class="n">answer_col</span></em>, <em class="sig-param"><span class="n">query_col</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">context_col</span><span class="o">=</span><span class="default_value">''</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.data_handler.kb_handler.kb_handler.parse_df" title="Permalink to this definition">¶</a></dt>
<dd><p>parses pandas DataFrame into responses, queries and mappings</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kb_name</strong> (<em>str</em>) – name of kb to be held in kb object</p></li>
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – contains the queries, responses and context strings</p></li>
<li><p><strong>answer_col</strong> (<em>str</em>) – column name string that points to responses</p></li>
<li><p><strong>query_col</strong> (<em>str</em>) – column name string that points to queries</p></li>
<li><p><strong>context_col</strong> (<em>str</em>) – column name string that points to context strings</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>kb object</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="src.data_handler.kb_handler.kb_handler.parse_pdf">
<code class="sig-name descname">parse_pdf</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">PDF_file_path</span></em>, <em class="sig-param"><span class="n">header</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">NumOfAppendix</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">kb_name</span><span class="o">=</span><span class="default_value">'pdf_kb'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.data_handler.kb_handler.kb_handler.parse_pdf" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to convert PDFs to Dataframe with columns as index number &amp; paragraphs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>PDF_file_path</strong> (<em>str</em>) – The filename and path of pdf</p></li>
<li><p><strong>header</strong> (<em>str</em>) – To remove the header in each page</p></li>
<li><p><strong>NumOfAppendix</strong> (<em>int</em>) – To remove the Appendix after the main content</p></li>
<li><p><strong>kb_name</strong> (<em>str</em>) – Name of returned kb object</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>kb class object</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="src.data_handler.kb_handler.kb_handler.parse_text">
<code class="sig-name descname">parse_text</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="n">clause_sep</span><span class="o">=</span><span class="default_value">'/n'</span></em>, <em class="sig-param"><span class="n">inner_clause_sep</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">query_idx</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">context_idx</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">kb_name</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.data_handler.kb_handler.kb_handler.parse_text" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse text file from kb path into query, response and mappings</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>str</em>) – path to txt file, or raw text</p></li>
<li><p><strong>clause_sep</strong> (<em>str</em>) – In the case that either query or context 
string is encoded within the first few 
sentences, inner_clause_sep may separate 
the sentences and query_idx and context_idx
will select the query and context strings 
accordingly</p></li>
<li><p><strong>inner_clause_sep</strong> (<em>str</em>) – See clause_sep</p></li>
<li><p><strong>query_idx</strong> (<em>int</em>) – See clause_sep</p></li>
<li><p><strong>context_idx</strong> (<em>int</em>) – See clause_sep</p></li>
<li><p><strong>kb_name</strong> (<em>str</em>) – name of output kb object</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>kb class object</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="src.data_handler.kb_handler.kb_handler.preview">
<code class="sig-name descname">preview</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="n">N</span><span class="o">=</span><span class="default_value">20</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.data_handler.kb_handler.kb_handler.preview" title="Permalink to this definition">¶</a></dt>
<dd><p>Print the first N lines of the file in path</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="src.data_handler.kb_handler.unique_indexing">
<code class="sig-prename descclassname">src.data_handler.kb_handler.</code><code class="sig-name descname">unique_indexing</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">non_unique</span></em><span class="sig-paren">)</span><a class="headerlink" href="#src.data_handler.kb_handler.unique_indexing" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a non_unique string pd.Series into a list of its indices of its unique list</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>non_unique</strong> (<em>pd.Series</em>) – containing non_unique values</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list contains the index of non unique values indexed by the unique values</p>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="GoldenRetriever’s API Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="src.finetune.html" class="btn btn-neutral float-left" title="Finetuning GoldenRetriever" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, AI Makerspace

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>